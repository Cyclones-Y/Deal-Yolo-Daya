# YOLO 数据处理与训练平台

这是一个基于 Streamlit 的综合应用，旨在简化 YOLO 目标检测数据集的工作流程。它提供了从原始数据处理到模型训练和可视化的完整流水线。

## 功能特性

本应用包含两个主要模式：**数据处理流水线** 和 **YOLO 训练平台**。

### 1. 数据处理流水线
用于准备训练数据的分步工作流：
*   **合并 CSV**：将多个标注 CSV/Excel 文件合并为一个数据集。
*   **去重**：根据图片来源 URL 删除重复条目。
*   **参考集过滤**：过滤掉已存在于参考数据集（如之前的训练集）中的数据。
*   **标签处理**：
    *   **多边形转 BBox**：将多边形点 (`ptList`) 转换为 YOLO 边界框。
    *   **标签映射**：根据配置重命名或合并类别标签。
*   **质量筛选**：根据 IoU（交并比）阈值和边界框数量筛选图片。
*   **数据集划分**：根据自定义规则自动将数据划分为训练/验证/测试集。
*   **YOLO 数据集生成**：下载图片并生成标准的 YOLOv11 数据集结构（images/labels/yaml）。
*   **可视化**：下载并可视化带有边界框的标注图片以进行验证。

### 2. YOLO 训练平台
用于管理 YOLOv11 训练实验的图形化界面：
*   **数据集管理**：浏览和选择数据集，可视化目录结构，预览图片/标签。
*   **训练配置**：
    *   选择模型权重（如 `yolo11.pt`）。
    *   配置超参数（轮数、批次大小、图片尺寸、设备等）。
    *   高级设置（优化器、学习率、数据增强等）。
    *   保存和加载训练配置模板。
*   **实时监控**：在应用内查看实时训练日志和进度。
*   **结果可视化**：分析训练结果，包括损失曲线、混淆矩阵和精确率-召回率曲线。

## 安装说明

1.  **获取项目代码**
    确保您已拥有项目文件。

2.  **安装依赖**
    建议使用虚拟环境。
    ```bash
    pip install -r requirements.txt
    ```
    *主要依赖：* `streamlit`, `pandas`, `requests`, `Pillow`, `ultralytics`, `pyyaml`。

## 使用指南

### 启动应用

推荐使用根目录下的 `run.py` 脚本启动：

```bash
# 标准方式
streamlit run run.py

# 或者使用 uv
uv run streamlit run run.py
```

或者直接运行模块入口：
```bash
streamlit run src/deal_yolo_data/app.py
```

### 操作流程

1.  **选择模式**：使用侧边栏在“数据处理”和“YOLO 训练平台”之间切换。

2.  **数据处理流程**：
    *   **上传数据**：上传您的原始 CSV 或 Excel 标注文件。
    *   **配置步骤**：调整每个处理步骤的设置（例如 IoU 阈值、划分比例）。
    *   **运行流水线**：按顺序执行步骤。应用会缓存中间结果，允许您重新运行特定步骤而无需从头开始。
    *   **下载结果**：下载处理后的数据集、中间 CSV 文件或最终的 YOLO 格式压缩包。

3.  **训练流程**：
    *   **选择数据集**：选择包含 `data.yaml` 文件的相关数据集目录。
    *   **配置训练**：设置模型路径、训练轮数（Epochs）和其他参数。
    *   **开始训练**：点击“开始训练”。您可以实时监控日志。
    *   **分析结果**：训练结束后，选择结果目录以查看指标和图表。

## 项目结构

本项目采用模块化架构设计：

```
src/deal_yolo_data/
├── app.py                  # 应用主入口（负责初始化与路由）
├── config.py               # 全局配置与常量
├── core/                   # 核心业务逻辑层
│   ├── processor.py        # 数据处理流水线逻辑
│   ├── training.py         # 模型训练逻辑
│   └── utils.py            # 通用工具函数库
└── ui/                     # 用户界面层
    ├── components.py       # 可复用UI组件
    ├── styles.py           # CSS样式定义
    └── pages/              # 页面逻辑
        ├── processing.py   # 数据处理页面逻辑
        └── training.py     # 训练平台页面逻辑
```

*   `run.py`: 根目录启动脚本，方便快速运行。
*   `runs/`: 存储处理输出和训练结果的默认目录。
